# 世界书条目生成核心指南 (v1.0)

本指南定义了“世界书生成器”插件中所有AI生成内容的标准格式。所有阶段的提示词都必须严格遵守此规范，以确保生成的世界书结构正确、逻辑清晰、运行高效。

---

## 1. 【蓝灯 / Constant】 - 世界的基石与索引

**用途**:

- 存储整个世界的核心、宏观设定（如历史、地理、种族总览）。
- 作为某一类详细设定（绿灯）的“目录”或“索引页”。
- **此类型条目永远处于激活状态**，是AI进行任何决策的基础背景。

**关键字段**:

- `prevent_recursion: true`: **必须设置**。防止该条目被其自身内容或其他条目意外触发，避免无限循环。
- `order`: **必须设置**。一个数字，决定了条目在SillyTavern中的处理顺序。**数值越大，优先级越高**。例如，`100`会比`50`先被处理。

**JSON 示例**:

```json
{
    "type": "constant",
    "keys": ["艾瑞亚大陆总览", "世界设定"],
    "comment": "【总览】艾瑞亚大陆核心设定",
    "prevent_recursion": true,
    "order": 100,
    "content": "这是一个关于艾瑞亚大陆的宏观设定索引。当需要了解以下具体内容时，请使用对应的关键词触发：\n- **主要人物**: [大魔导师奥斯顿](奥斯顿, 白塔的主人)\n- **重要地点**: [白塔城](白塔城, 魔法之都)\n- **重大历史**: [碎裂之战](碎裂之战, 古神黄昏)"
}
```

---

## 2. 【机制蓝灯 / System-Level Constant】 - 世界的规则与导演

**用途**:
这是最高优先级的条目类型，其内容会作为“系统消息”注入，强制AI遵守。它分为三个层次：

---

### **层次一：`depth: 0` - 核心运作指令 (必须有且只有一个)**

**用途**: 定义游戏的整体运作方式、AI的核心职责、写作风格、视角、字数要求等元指令。
**JSON 示例**:

```json
{
    "uid": -1,
    "comment": "【核心机制】游戏运作总纲",
    "content": "<元指令>\n【强制要求：...禁止替用户做决定...使用上帝视角写剧情...】\n生成日常对话用语言风格：冰冷、直白、粗粝\n生成nsfw场景用日本官能小说风格...\n正文结尾必须是以npc的对话和行为结束...\n</元指令>",
    "key": ["*"],
    "type": "constant",
    "position": "at_depth_as_system",
    "depth": 0,
    "prevent_recursion": true,
    "order": 999
}
```

---

### **层次二：`depth: 2` - UI功能面板 (必须有状态栏，可选3-5个其他面板)**

**用途**: 定义在正文后输出的、可交互的UI面板，如状态栏、弹幕、任务列表等。其`content`字段必须包含`<details>` HTML结构。
**JSON 示例 (状态栏)**:

````json
{
    "uid": -1,
    "comment": "【UI】状态栏",
    "content": "在正文结束后，必须生成一个状态栏。格式如下：\n```\n<details><summary>**状态栏**</summary>\n<data>\n**人物姓名**: \n**表情**: \n**动作**: \n**想法**: \n**心理活动**: \n**状态**: \n**好感度**: \n</data>\n</details>\n```",
    "key": ["状态栏"],
    "type": "constant",
    "position": "at_depth_as_system",
    "depth": 2,
    "prevent_recursion": true,
    "order": 200
}
````

**JSON 示例 (弹幕功能)**:

````json
{
    "uid": -1,
    "comment": "【UI】弹幕功能",
    "content": "在正文结束后，必须生成弹幕栏目，且在所有UI面板中位置最末。格式如下：\n```\n<details><summary>**弹幕**</summary>\n<data>\n【乐子人弹幕】\n1. [乐子人] 666，开局就这么刺激！\n...\n【友善弹幕】\n1. [友善路人] 竹叶青大佬气场好强...\n</data>\n</details>\n```",
    "key": ["弹幕"],
    "type": "constant",
    "position": "at_depth_as_system",
    "depth": 2,
    "prevent_recursion": true,
    "order": 199
}
````

---

### **层次三：`depth: 3/4` - 游戏性机制 (5-10个)**

**用途**: 定义具体的、用于指导剧情的润滑剂式规则，如好感度、经验值、经济系统等。
**JSON 示例**:

```json
{
    "uid": -1,
    "comment": "【机制】好感度系统",
    "content": "当玩家做出符合NPC价值观的行为时，其好感度会提升。提升好感度可以解锁特殊对话和剧情。当前好感度等级：[冷淡/友好/信赖/挚爱]",
    "key": ["好感度"],
    "type": "constant",
    "position": "at_depth_as_system",
    "depth": 3,
    "prevent_recursion": true,
    "order": 150
}
```

---

## 3. 【绿灯 / Normal】 - 世界的血肉与细节

**用途**:

- 存储具体的、详细的设定，如一个人物的完整传记、一个城市的详细描绘、一件神器的历史等。
- **此类型条目默认不激活**。只有当对话中出现其`keys`中定义的关键词时，其内容才会被发送给AI。

**关键字段**:

- `comment`: **必须是清晰、简洁的标题**。例如“【人物】大魔导师奥斯顿”，而不是“一个关于大法师的故事”。
- `keys`: **必须包含所有能触发此条目的关键词**。特别是`content`中出现的所有专有名词（人名、地名、组织名等）都应被提取到`keys`中。

**JSON 示例**:

```json
{
    "type": "normal",
    "keys": ["奥斯顿", "大魔导师奥斯顿", "白塔的主人", "魔法联邦"],
    "comment": "【人物】大魔导师奥斯顿",
    "content": "奥斯顿是魔法联邦的现任领袖，居住在白塔之巅。他外表看起来只有三十岁，但实际上已经活了超过三百年。他性格沉稳，智慧超群，但对科技抱有深深的戒心。他的目标是找到阻止“源力侵蚀”的方法，为此不惜一切代价。"
}
```
