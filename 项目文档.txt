# 一键做卡工具（自动生成角色卡+世界书） 项目文档

---

## v2.0.0 (2025-07-18)

### 新增功能

1.  **后台用户数据统计:**
    *   在订单管理后台 (`admin.html`) 中，新增了“用户数据”视图。
    *   管理员现在可以通过切换视图，查看所有用户的唯一ID、剩余AI调用次数以及数据最后更新时间。

2.  **插件端用户识别与数据同步:**
    *   插件现在会为每一位首次使用的用户生成一个唯一的 `userId`，并保存在本地。
    *   每次启动插件、使用AI调用次数或成功充值后，插件都会自动将用户的 `userId` 和最新的剩余次数上报给服务器。
    *   这使得管理员可以实时追踪每位用户的使用情况。

### 技术实现

*   **前端 (`admin.html`):**
    *   增加了“管理订单”和“用户数据”的切换按钮。
    *   添加了用于显示用户数据的新表格和渲染逻辑 (`fetchUsersData`, `renderUsers`)。

*   **后端 (`api/index.js`):**
    *   新增 `POST /api/update-user` 接口，用于插件端创建新用户和更新现有用户数据。
    *   新增 `GET /api/users-data` 接口，供管理员后台获取所有用户的数据。
    *   用户数据存储在 Upstash Redis 的一个新的哈希表 `users` 中。

*   **插件端 (`index.js`):**
    *   引入了新的 `userManager` 模块，负责管理 `userId` 的本地存储和与服务器的数据同步。
    *   修改了 `creditManager` 模块，在次数变动时（使用或增加）触发 `userManager.sync()`，确保数据实时更新。
